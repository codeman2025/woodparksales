<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slushie Picker</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js"></script>
</head>
<body>
    <h1>Slushie Picker</h1>

    <div>
        <label for="flavor">Choose your flavors:</label>
        <select id="flavor" multiple>
            <option value="ribena">Ribena (Apple & Blackcurrant)</option>
            <option value="lime">Lime</option>
            <option value="plain">Plain</option>
        </select>
    </div>

    <div>
        <label for="size">Choose your size:</label>
        <select id="size">
            <option value="small">Small</option>
            <option value="medium">Medium</option>
            <option value="large">Large</option>
        </select>
    </div>

    <button onclick="mixSlushie()">Mix It!</button>

    <div id="result"></div>

    <script>
        // Import the functions you need from Firebase SDK
        import { initializeApp } from "firebase/app";
        import { getFirestore, collection, addDoc, serverTimestamp } from "firebase/firestore"; 

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBVUrnaxeUHnPgXq7reIO-ZG3DptpF0P0k",
            authDomain: "slushiepicker.firebaseapp.com",
            projectId: "slushiepicker",
            storageBucket: "slushiepicker.firebasestorage.app",
            messagingSenderId: "753485351126",
            appId: "1:753485351126:web:9696c75375fc212f6de177",
            measurementId: "G-C0TTW8CDCF"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Function to send order to Firestore
        function sendOrderToFirestore(flavor, size, totalPrice) {
            addDoc(collection(db, "orders"), {
                flavor: flavor,
                size: size,
                price: totalPrice,
                timestamp: serverTimestamp() // Adds a timestamp
            })
            .then(() => {
                console.log("Order sent to Firestore!");
            })
            .catch((error) => {
                console.error("Error sending order: ", error);
            });
        }

        // Function to handle slushie mixing and sending order
        function mixSlushie() {
            const flavorSelect = document.getElementById('flavor');
            const sizeSelect = document.getElementById('size');
            const resultDiv = document.getElementById('result');

            const flavors = Array.from(flavorSelect.selectedOptions).map(option => option.text).join(", ");
            const size = sizeSelect.value;

            let basePrice = 0;
            let flavorCost = 0;

            // Set base price for each size
            if (size === "small") basePrice = 2;
            else if (size === "medium") basePrice = 3;
            else if (size === "large") basePrice = 4;

            // Calculate extra cost for each additional flavor
            const extraFlavors = flavorSelect.selectedOptions.length - 1;
            flavorCost = extraFlavors * 0.5; // €0.50 for each extra flavor

            const totalPrice = (basePrice + flavorCost).toFixed(2); // Total price rounded to 2 decimals

            if (flavors && size) {
                resultDiv.innerHTML = `Your ${size} slushie: ${flavors} <br> Total price: €${totalPrice}`;

                // Send order to Firestore
                sendOrderToFirestore(flavors, size, totalPrice);
            } else {
                resultDiv.innerHTML = "Please select both a flavor and size.";
            }
        }
    </script>
</body>
</html>
